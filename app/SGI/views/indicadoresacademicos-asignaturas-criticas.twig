{% extends "base.twig" %}
{% block title %}Asignaturas Críticas {% endblock %}
{% block contentheader %}Asignaturas Críticas{% endblock %}
{% block content %}

		<section class="content">
			<!-- Main row -->
			<div class="row">
				<!-- Left col -->
				<section class="col-lg-12 connectedSortable">
					<div class="box box-success">
						<div class="box-header">
							<div class="box-tools pull-right" data-toggle="tooltip" title="Status">
							</div>
						</div>
						<div class="box-body chat" id="chat-box">
							<div class="row">
								<div class="col-xs-12">
									<canvas id="canvas1" height="300" width="500"></canvas>
								</div>
								<div class="col-xs-2 col-sm-3">
									 <button class="btn btn-block btn-primary" id="exportar_grafico1"><i class="fa fa-area-chart"></i> Exportar Gráfico</button>
									 <br>
								</div>
							</div>
							
							<div class="row">

								<div class="col-xs-12">
									<div class="table-responsive">
	                    				<table class="table table-bordered table-hover" id="tabla">
											<thead>
												<tr>
													<th colspan="15">Asignaturas críticas</th>
												</tr>
												<tr>
													<th colspan="15">Casa Central</th>
												</tr>
												<tr>
													<th rowspan="2">Asignatura</th>
													<th rowspan="2">Comuna</th>
													<th rowspan="2">Jornada</th>
													<th rowspan="2">Modalidad</th>
													<th colspan="11">% de aprobación promedio (semestral o anual) últimos 5 años</th>
												</tr>
												<tr>
													<th>2011-1</th>
													<th>2011-2</th>
													<th>2012-1</th>
													<th>2012-2</th>
													<th>2013-1</th>
													<th>2013-2</th>
													<th>2014-1</th>
													<th>2014-2</th>
													<th>2015-1</th>
													<th>2015-2</th>
													<th>% promedio de los últimos 5 años</th>
												</tr>
											</thead>										
											<tbody>
												<tr>
													<td>MATEMATICAS III</td>
													<td>Valparaíso</td>
													<td>Diurna</td>
													<td>Presencial</td>
													<td>100%</td>
													<td>100%</td>
													<td>27%</td>
													<td>20%</td>
													<td>68%</td>
													<td>22%</td>
													<td>56%</td>
													<td>20%</td>
													<td>23%</td>
													<td>39%</td>
													<td>47%</td>
												</tr>
												<tr>
													<td>MATEMATICA II</td>
													<td>Valparaíso</td>
													<td>Diurna</td>
													<td>Presencial</td>
													<td>100%</td>
													<td>75%</td>
													<td>16%</td>
													<td>47%</td>
													<td>19%</td>
													<td>81%</td>
													<td>36%</td>
													<td>41%</td>
													<td>43%</td>
													<td>55%</td>
													<td>51%</td>
												</tr>
												<tr>
													<td>MATEMATICAS IV</td>
													<td>Valparaíso</td>
													<td>Diurna</td>
													<td>Presencial</td>
													<td></td>
													<td>100%</td>
													<td>0%</td>
													<td>50%</td>
													<td>61%</td>
													<td>56%</td>
													<td>20%</td>
													<td>61%</td>
													<td>66%</td>
													<td>71%</td>
													<td>54%</td>
												</tr>
												<tr>
													<td>MATEMATICA I</td>
													<td>Valparaíso</td>
													<td>Diurna</td>
													<td>Presencial</td>
													<td>94%</td>
													<td>100%</td>
													<td>37%</td>
													<td>56%</td>
													<td>52%</td>
													<td>36%</td>
													<td>47%</td>
													<td>30%</td>
													<td>58%</td>
													<td>71%</td>
													<td>58%</td>
												</tr>
												<tr>
													<td>PROGRAMACION</td>
													<td>Valparaíso</td>
													<td>Diurna</td>
													<td>Presencial</td>
													<td>100%</td>
													<td>90%</td>
													<td>29%</td>
													<td>59%</td>
													<td>70%</td>
													<td>55%</td>
													<td>78%</td>
													<td>44%</td>
													<td>67%</td>
													<td>39%</td>
													<td>63%</td>
												</tr>
												<tr>
													<td>HIDROMETALURGIA</td>
													<td>Valparaíso</td>
													<td>Diurna</td>
													<td>Presencial</td>
													<td></td>
													<td></td>
													<td></td>
													<td></td>
													<td></td>
													<td>85%</td>
													<td></td>
													<td>62%</td>
													<td></td>
													<td>52%</td>
													<td>66%</td>
												</tr>
												<tr>
													<td>FISICA GENERAL III</td>
													<td>Valparaíso</td>
													<td>Diurna</td>
													<td>Presencial</td>
													<td>100%</td>
													<td>100%</td>
													<td>12%</td>
													<td>65%</td>
													<td>63%</td>
													<td>97%</td>
													<td>62%</td>
													<td>65%</td>
													<td>62%</td>
													<td>53%</td>
													<td>68%</td>
												</tr>
												<tr>
													<td>TALLER DE TITULACIÓN</td>
													<td>Valparaíso</td>
													<td>Diurna</td>
													<td>Presencial</td>
													<td></td>
													<td></td>
													<td></td>
													<td></td>
													<td>83%</td>
													<td>100%</td>
													<td>78%</td>
													<td>62%</td>
													<td>50%</td>
													<td>36%</td>
													<td>68%</td>
												</tr>
												<tr>
													<td>METALURGIA FÍSICA II</td>
													<td>Valparaíso</td>
													<td>Diurna</td>
													<td>Presencial</td>
													<td></td>
													<td></td>
													<td></td>
													<td></td>
													<td>43%</td>
													<td>88%</td>
													<td>60%</td>
													<td></td>
													<td>83%</td>
													<td></td>
													<td>69%</td>
												</tr>
												<tr>
													<td>INFORMACION Y CONTROL FINANCIERO</td>
													<td>Valparaíso</td>
													<td>Diurna</td>
													<td>Presencial</td>
													<td>100%</td>
													<td>100%</td>
													<td>50%</td>
													<td>44%</td>
													<td>75%</td>
													<td>42%</td>
													<td>76%</td>
													<td>60%</td>
													<td>90%</td>
													<td>55%</td>
													<td>69%</td>
												</tr>
											</tbody>
										</table>
									</div>
								</div>
								<div class="col-xs-2 col-sm-3">
									<button class="btn btn-block btn-primary" id="exportar_tabla"><i class="fa fa-table"></i> Exportar Tabla</button>
								</div>					

							</div>
						</div>
					</div>
				</section><!-- /.Left col -->
				<!-- right col (We are only adding the ID to make the widgets sortable)-->
			</div><!-- /.row (main row) -->
		</section><!-- /.content -->
		<div style="font-size:0;height:800px;"></div>
		<input id="csrf" type="hidden" name="{{csrf_key}}" value="{{csrf_token}}">
{% endblock %}
{% block scripts %}
<script src="{{ baseUrl() }}/js/xlsx.core.min.js"></script>
<script src="{{ baseUrl() }}/js/Blob.js"  type="text/javascript"></script>
<script src="{{ baseUrl() }}/js/FileSaver.js"  type="text/javascript"></script>
<script src="{{ baseUrl() }}/js/tabla.js"  type="text/javascript"></script>
<script src="{{ baseUrl() }}/js/bootstrap-datepicker.js"></script>
<script src="{{ baseUrl() }}/js/jquery.table2excel.js"></script>
<script src="{{ baseUrl() }}/js/ChartNew.js"></script>
<script>
$("#exportar_tabla").on('click', function(){
		
		export_table_to_excel('tabla', 'Asignaturas Criticas  ');
});

$("#exportar_grafico").on('click', function(){
		$("#canvas").mousedown();
});
</script>
<script>
// Canvas 1
var myBarChart1;
var data1 = {
	labels: ['Matemáticas III','Matemáticas II','Matemáticas IV','Matemáticas I','Programación','Hidrometalurgia','Física General III','Taller de Titulación','Metalurgia Física II','Información y Control Financiero'],
	datasets: [
		{
            label: "% Aprobacion Promedio",
            fillColor: "#ff9c43",
            strokeColor: "rgba(220,220,220,0.8)",
            highlightFill: "rgba(220,220,220,0.75)",
            highlightStroke: "rgba(220,220,220,1)",
            data: [47,51,54,58,63,66,68,68,69,69]
        }
	],
    graphMax: 100,
};
var ctx1 = $("#canvas1").get(0).getContext("2d");
myBarChart1 = new Chart(ctx1).Bar(data1, {
responsive: true,
rotateLabels: 90,
bezierCurve : false,
datasetFill : false,
/* El objeto 'scales' en las versiones 2.x es muy distinto por lo cual este codigo quedará obsoleto. Para version 2.x revisar la documentación oficial. 
*/
// override a objeto scale
scaleOverride : true,
scaleSteps : 5, 		// cantidad de intervalos
scaleStepWidth : 20, 	// intervalo minimo
scaleStartValue : 0 , 	// punto de partida
// fin override a objeto scale
legend : true,
savePng : true,
savePngOutput: "Save",
xAxisLabel: "Asignaturas",
yAxisLabel: "% Aprobacion Promedio",
annotateDisplay : true,
annotateLabel: "<%= v1 %> <%= v2 %> - <%= v3 %>%",
});

$("#exportar_grafico1").on('click', function(){
	$.ajax({
	url:'../api/save_canvas',
	type:'POST',
	data:{
			data:document.getElementById("canvas1").toDataURL("image/png"),
			csrf_token: $("#csrf").val()
	}

}).success(function(data){
	var a = document.createElement('a');
	a.href = "../img/grafico.png";
	a.download = "grafico.png";
	document.body.appendChild(a);
	a.click();
	document.body.removeChild(a);
});
});

</script>
{% endblock %}
